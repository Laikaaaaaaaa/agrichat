<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Tin t·ª©c N√¥ng nghi·ªáp - AgriSense AI</title>
  
  <!-- Favicon -->
  <link rel="icon" type="image/x-icon" href="/static/favicon logo/favicon/favicon.ico">
  <link rel="icon" type="image/svg+xml" href="/static/favicon logo/favicon/favicon.svg">
  <link rel="icon" type="image/png" sizes="96x96" href="/static/favicon logo/favicon/favicon-96x96.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/static/favicon logo/favicon/apple-touch-icon.png">
  <link rel="manifest" href="/static/favicon logo/favicon/site.webmanifest">
  
  <!-- Tailwind CSS CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Font Awesome 6 -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
  <style>
    /* Custom animations - matching index.html */
    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    
    .fade-in-up {
      animation: fadeInUp 0.5s ease-out;
    }
    
    .news-card {
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }
    
    .news-card:hover {
      transform: translateY(-4px);
      box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
    }
    
    .category-button {
      transition: all 0.3s ease;
    }
    
    .category-button.active {
      background-color: #10b981;
      color: white;
    }
    
    .loading-spinner {
      border: 3px solid #f3f3f3;
      border-top: 3px solid #10b981;
      border-radius: 50%;
      width: 40px;
      height: 40px;
      animation: spin 1s linear infinite;
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    /* Line clamp utilities */
    .line-clamp-2 {
      display: -webkit-box;
      -webkit-line-clamp: 2;
      line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }
    
    .line-clamp-3 {
      display: -webkit-box;
      -webkit-line-clamp: 3;
      line-clamp: 3;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }
  </style>
</head>
<body class="bg-green-50 font-sans text-gray-700 min-h-screen">
  <!-- Header - matching index.html style -->
  <header class="bg-green-100 border-b border-green-200 shadow-sm flex-shrink-0">
    <div class="w-full flex justify-between items-center py-3 px-4 md:py-4 md:px-6">
      <div class="flex items-center gap-3">
        <!-- Back button with same style as menu toggle -->
        <button onclick="goBack()" class="text-white bg-green-600 hover:bg-green-700 transition-colors p-2 rounded-lg shadow-lg border-2 border-green-500 font-bold text-sm">
          <i class="fas fa-arrow-left"></i>
        </button>
        <!-- Logo -->
        <img src="/static/logo/logo.png" alt="AgriSense AI Logo" class="h-12 md:h-14 w-auto object-contain">
      </div>
      <span class="text-xs md:text-sm text-gray-500 hidden md:block">Tin t·ª©c n√¥ng nghi·ªáp th√¥ng minh</span>
      <div class="flex items-center gap-2 md:gap-4">
        <span class="text-xs md:text-sm text-green-500">ƒêang t·∫£i tin t·ª©c...</span>
      </div>
    </div>
  </header>

  <!-- Main Content Container - matching index.html structure -->
  <div class="w-full px-2 md:px-4 relative" style="min-height: calc(100vh - 80px);">
    <!-- Main Content Area - matching chat-main style -->
    <main class="bg-white shadow-lg rounded-2xl p-3 md:p-6 flex flex-col w-full relative mx-auto max-w-7xl mt-4" style="min-height: calc(100vh - 120px);">
      
      <!-- Page Header -->
      <div class="text-center mb-6 md:mb-8 pb-4 border-b border-gray-100">
        <h1 class="text-2xl md:text-3xl font-bold text-green-800 mb-3">
          <i class="fas fa-newspaper text-green-600 mr-3"></i>
          <span id="page-title">Tin t·ª©c N√¥ng nghi·ªáp</span>
        </h1>
        <p class="text-sm md:text-base text-gray-600 max-w-2xl mx-auto">
          C·∫≠p nh·∫≠t nh·ªØng tin t·ª©c m·ªõi nh·∫•t v·ªÅ n√¥ng nghi·ªáp, c√¥ng ngh·ªá, kh√≠ h·∫≠u v√† chƒÉn nu√¥i
        </p>
      </div>

      <!-- Search and Filters Section -->
      <div class="mb-6 space-y-4">
        <!-- Search Bar -->
        <div class="flex justify-center">
          <div class="relative w-full max-w-md">
            <input 
              type="text" 
              id="search-input"
              placeholder="T√¨m ki·∫øm tin t·ª©c..." 
              spellcheck="false"
              class="w-full pl-10 pr-20 py-3 border-2 border-green-200 rounded-xl focus:ring-2 focus:ring-green-400 focus:border-green-500 shadow-sm text-sm md:text-base"
            />
            <i class="fas fa-search absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
            
            <!-- Clear button -->
            <button id="clear-search" onclick="clearSearch()" class="absolute right-12 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600 transition-colors hidden">
              <i class="fas fa-times"></i>
            </button>
            
            <!-- Search button -->
            <button onclick="searchNews()" class="absolute right-2 top-1/2 transform -translate-y-1/2 bg-green-500 hover:bg-green-600 text-white p-2 rounded-lg transition-colors">
              <i class="fas fa-search text-sm"></i>
            </button>
          </div>
        </div>

        <!-- Search Results Info -->
        <div id="search-results-info" class="text-center text-sm text-gray-600 hidden">
          <i class="fas fa-info-circle mr-1"></i>
          <span id="search-results-text"></span>
        </div>

        <!-- Category Filters -->
        <div class="flex flex-wrap justify-center gap-2 md:gap-3">
          <button class="category-button active px-3 md:px-4 py-2 rounded-full border-2 border-green-500 hover:border-green-600 text-xs md:text-sm font-medium transition-colors" data-category="all">
            <i class="fas fa-globe-americas mr-1"></i>
            T·∫•t c·∫£
          </button>
          <button class="category-button px-3 md:px-4 py-2 rounded-full border-2 border-green-300 hover:border-green-500 text-xs md:text-sm font-medium transition-colors" data-category="agriculture">
            <i class="fas fa-seedling mr-1"></i>
            N√¥ng nghi·ªáp
          </button>
          <button class="category-button px-3 md:px-4 py-2 rounded-full border-2 border-green-300 hover:border-green-500 text-xs md:text-sm font-medium transition-colors" data-category="technology">
            <i class="fas fa-microchip mr-1"></i>
            C√¥ng ngh·ªá
          </button>
          <button class="category-button px-3 md:px-4 py-2 rounded-full border-2 border-green-300 hover:border-green-500 text-xs md:text-sm font-medium transition-colors" data-category="climate">
            <i class="fas fa-cloud mr-1"></i>
            Kh√≠ h·∫≠u
          </button>
          <button class="category-button px-3 md:px-4 py-2 rounded-full border-2 border-green-300 hover:border-green-500 text-xs md:text-sm font-medium transition-colors" data-category="livestock">
            <i class="fa-solid fa-cow mr-1"></i>
            ChƒÉn nu√¥i
          </button>
        </div>
      </div>

      <!-- Loading Spinner -->
      <div id="loading" class="text-center py-12">
        <div class="loading-spinner mx-auto mb-4"></div>
        <p class="text-gray-600 text-sm md:text-base">ƒêang t·∫£i tin t·ª©c...</p>
      </div>

      <!-- News Grid -->
      <div id="news-container" class="hidden flex-1 overflow-auto" style="min-height: 0;">
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 md:gap-6 w-full">
          <!-- News items will be dynamically inserted here -->
        </div>
      </div>

      <!-- No Results -->
      <div id="no-results" class="text-center py-12 hidden">
        <i class="fas fa-newspaper text-gray-300 text-4xl md:text-6xl mb-4"></i>
        <h3 class="text-lg md:text-xl font-semibold text-gray-600 mb-2">Kh√¥ng t√¨m th·∫•y tin t·ª©c</h3>
        <p class="text-sm md:text-base text-gray-500">Th·ª≠ t√¨m ki·∫øm v·ªõi t·ª´ kh√≥a kh√°c ho·∫∑c ch·ªçn danh m·ª•c kh√°c</p>
      </div>

      <!-- Load More Button -->
      <div class="text-center mt-6 pt-4 border-t border-gray-100">
        <button id="load-more" class="hidden bg-green-500 hover:bg-green-600 text-white px-6 py-3 rounded-xl font-medium transition-colors shadow-sm">
          <i class="fas fa-plus mr-2"></i>
          T·∫£i th√™m tin t·ª©c
        </button>
      </div>
    </main>
  </div>

  <!-- Footer - matching green theme -->
  <footer class="bg-green-100 border-t border-green-200 mt-8">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6">
      <div class="text-center">
        <div class="flex items-center justify-center gap-2 mb-3">
          <i class="fas fa-leaf text-green-800 text-lg"></i>
          <h3 class="text-lg font-bold text-green-800">AgriSense AI</h3>
        </div>
        <p class="text-sm text-gray-600">¬© 2025 AgriSense AI. T·∫•t c·∫£ quy·ªÅn ƒë∆∞·ª£c b·∫£o l∆∞u.</p>
        <p class="text-xs text-gray-500 mt-1">Chuy√™n gia t∆∞ v·∫•n n√¥ng nghi·ªáp th√¥ng minh</p>
      </div>
    </div>
  </footer>

  <script>
    // News API Configuration
    const newsAPIs = [
      'df2bad590b1349e980a3123efe8b26b8',
      '09479cf1408a4221a37bb8eeb4944d57',
      'ac9afdf035ae40a6aac44a3e9bbdb676',
      'b2631d135606454b90e5f91a4b65c005'
    ];
    
    // Vietnamese RSS feeds for agriculture and related news
    const vietnameseRSSFeeds = [
      // N√¥ng nghi·ªáp m√¥i tr∆∞·ªùng
      {
        name: 'N√¥ng nghi·ªáp M√¥i tr∆∞·ªùng - ChƒÉn nu√¥i',
        url: 'https://nongnghiepmoitruong.vn/chan-nuoi.rss',
        category: 'livestock'
      },
      {
        name: 'N√¥ng nghi·ªáp M√¥i tr∆∞·ªùng - T√°i c∆° c·∫•u',
        url: 'https://nongnghiepmoitruong.vn/tai-co-cau-nong-nghiep.rss',
        category: 'agriculture'
      },
      {
        name: 'N√¥ng nghi·ªáp M√¥i tr∆∞·ªùng - Khuy·∫øn n√¥ng',
        url: 'https://nongnghiepmoitruong.vn/khuyen-nong.rss',
        category: 'agriculture'
      },
      {
        name: 'N√¥ng nghi·ªáp M√¥i tr∆∞·ªùng - Khoa h·ªçc C√¥ng ngh·ªá',
        url: 'https://nongnghiepmoitruong.vn/khoa-hoc---cong-nghe.rss',
        category: 'technology'
      },
      {
        name: 'N√¥ng nghi·ªáp M√¥i tr∆∞·ªùng - Th·ªßy s·∫£n',
        url: 'https://nongnghiepmoitruong.vn/thuy-san.rss',
        category: 'agriculture'
      },
      {
        name: 'N√¥ng nghi·ªáp M√¥i tr∆∞·ªùng - L√¢m nghi·ªáp',
        url: 'https://nongnghiepmoitruong.vn/lam-nghiep.rss',
        category: 'agriculture'
      },
      {
        name: 'N√¥ng nghi·ªáp M√¥i tr∆∞·ªùng - M√¥i tr∆∞·ªùng',
        url: 'https://nongnghiepmoitruong.vn/cau-chuyen-moi-truong.rss',
        category: 'climate'
      },
      {
        name: 'N√¥ng nghi·ªáp M√¥i tr∆∞·ªùng - Kho√°ng s·∫£n',
        url: 'https://nongnghiepmoitruong.vn/khoang-san.rss',
        category: 'business'
      },
      {
        name: 'N√¥ng nghi·ªáp M√¥i tr∆∞·ªùng - T√†i nguy√™n n∆∞·ªõc',
        url: 'https://nongnghiepmoitruong.vn/tai-nguyen-nuoc.rss',
        category: 'climate'
      },
      {
        name: 'N√¥ng nghi·ªáp M√¥i tr∆∞·ªùng - Kinh t·∫ø th·ªã tr∆∞·ªùng',
        url: 'https://nongnghiepmoitruong.vn/kinh-te-thi-truong.rss',
        category: 'economy'
      },
      {
        name: 'N√¥ng nghi·ªáp M√¥i tr∆∞·ªùng - Bi·∫øn ƒë·ªïi kh√≠ h·∫≠u',
        url: 'https://nongnghiepmoitruong.vn/bien-doi-khi-hau-moitruong.rss',
        category: 'climate'
      },
      
      // VnExpress
      {
        name: 'VnExpress - N√¥ng nghi·ªáp',
        url: 'https://vnexpress.net/tag/nong-nghiep.rss',
        category: 'agriculture'
      },
      {
        name: 'VnExpress - N√¥ng nghi·ªáp c√¥ng ngh·ªá cao',
        url: 'https://vnexpress.net/tag/nong-nghiep-cong-nghe-cao.rss',
        category: 'agriculture'
      },
      {
        name: 'VnExpress - N√¥ng nghi·ªáp s·∫°ch',
        url: 'https://vnexpress.net/topic/nong-nghiep-sach-21685.rss',
        category: 'agriculture'
      },
      {
        name: 'VnExpress - Khoa h·ªçc',
        url: 'https://vnexpress.net/rss/khoa-hoc.rss',
        category: 'technology'
      },
      {
        name: 'VnExpress - Th·ªùi s·ª±',
        url: 'https://vnexpress.net/rss/thoi-su.rss',
        category: 'news'
      },
      {
        name: 'VnExpress - Kinh doanh',
        url: 'https://vnexpress.net/rss/kinh-doanh.rss',
        category: 'business'
      },
      {
        name: 'VnExpress - S·ª©c kh·ªèe',
        url: 'https://vnexpress.net/rss/suc-khoe.rss',
        category: 'health'
      },
      {
        name: 'VnExpress - Th·∫ø gi·ªõi',
        url: 'https://vnexpress.net/rss/the-gioi.rss',
        category: 'world'
      },
      {
        name: 'VnExpress - Gi√°o d·ª•c',
        url: 'https://vnexpress.net/rss/giao-duc.rss',
        category: 'education'
      },
      {
        name: 'VnExpress - Ph√°p lu·∫≠t',
        url: 'https://vnexpress.net/rss/phap-luat.rss',
        category: 'law'
      },
      {
        name: 'VnExpress - M√¥i tr∆∞·ªùng',
        url: 'https://vnexpress.net/rss/thoi-su/moi-truong.rss',
        category: 'climate'
      },
      {
        name: 'VnExpress - Tin m·ªõi nh·∫•t',
        url: 'https://vnexpress.net/rss/tin-moi-nhat.rss',
        category: 'news'
      },
      {
        name: 'VnExpress - Tin xem nhi·ªÅu',
        url: 'https://vnexpress.net/rss/tin-xem-nhieu.rss',
        category: 'news'
      },
      {
        name: 'VnExpress - Du l·ªãch',
        url: 'https://vnexpress.net/rss/du-lich.rss',
        category: 'travel'
      },
      {
        name: 'VnExpress - Khoa h·ªçc T·ª± nhi√™n',
        url: 'https://vnexpress.net/rss/khoa-hoc/tu-nhien.rss',
        category: 'technology'
      },
      {
        name: 'VnExpress - Khoa h·ªçc ·ª®ng d·ª•ng',
        url: 'https://vnexpress.net/rss/khoa-hoc/ung-dung.rss',
        category: 'technology'
      },
      {
        name: 'VnExpress - Ph√°t minh',
        url: 'https://vnexpress.net/rss/khoa-hoc/phat-minh.rss',
        category: 'technology'
      },
      {
        name: 'VnExpress - Kh√°m ph√°',
        url: 'https://vnexpress.net/rss/khoa-hoc/kham-pha.rss',
        category: 'technology'
      },
      {
        name: 'VnExpress - B·∫£o v·ªá m√¥i tr∆∞·ªùng',
        url: 'https://vnexpress.net/rss/khoa-hoc/bao-ve-moi-truong.rss',
        category: 'climate'
      },
      {
        name: 'VnExpress - Nh√† khoa h·ªçc Vi·ªát',
        url: 'https://vnexpress.net/rss/khoa-hoc/nha-khoa-hoc-viet.rss',
        category: 'technology'
      },
      
      // Tu·ªïi Tr·∫ª
      {
        name: 'Tu·ªïi Tr·∫ª - Khoa h·ªçc',
        url: 'https://tuoitre.vn/rss/khoa-hoc.rss',
        category: 'technology'
      },
      {
        name: 'Tu·ªïi Tr·∫ª - Th·ªùi s·ª±',
        url: 'https://tuoitre.vn/rss/thoisu.rss',
        category: 'news'
      },
      {
        name: 'Tu·ªïi Tr·∫ª - Kinh t·∫ø',
        url: 'https://tuoitre.vn/rss/kinhte.rss',
        category: 'economy'
      },
      {
        name: 'Tu·ªïi Tr·∫ª - Gi√°o d·ª•c',
        url: 'https://tuoitre.vn/rss/giaoduc.rss',
        category: 'education'
      },
      {
        name: 'Tu·ªïi Tr·∫ª - S·ª©c kh·ªèe',
        url: 'https://tuoitre.vn/rss/suckhoe.rss',
        category: 'health'
      },
      {
        name: 'Tu·ªïi Tr·∫ª - Th·∫ø gi·ªõi',
        url: 'https://tuoitre.vn/rss/thegioi.rss',
        category: 'world'
      },
      {
        name: 'Tu·ªïi Tr·∫ª - Ch√≠nh tr·ªã',
        url: 'https://tuoitre.vn/rss/chinhtri.rss',
        category: 'politics'
      },
      {
        name: 'Tu·ªïi Tr·∫ª - VƒÉn h√≥a',
        url: 'https://tuoitre.vn/rss/vanhoa.rss',
        category: 'culture'
      },
      {
        name: 'Tu·ªïi Tr·∫ª - B·∫°n ƒë·ªçc',
        url: 'https://tuoitre.vn/rss/ban-doc.rss',
        category: 'news'
      },
      {
        name: 'Tu·ªïi Tr·∫ª - Nh·ªãp s·ªëng tr·∫ª',
        url: 'https://tuoitre.vn/rss/nhip-song-tre.rss',
        category: 'lifestyle'
      },
      {
        name: 'Tu·ªïi Tr·∫ª - B·∫°n ƒë·ªçc l√†m b√°o',
        url: 'https://tuoitre.vn/rss/ban-doc-lam-bao.rss',
        category: 'news'
      },
      {
        name: 'Tu·ªïi Tr·∫ª - Du l·ªãch',
        url: 'https://tuoitre.vn/rss/du-lich.rss',
        category: 'travel'
      },
      {
        name: 'Tu·ªïi Tr·∫ª - M√¥i tr∆∞·ªùng',
        url: 'https://tuoitre.vn/rss/thoi-su/moi-truong.rss',
        category: 'climate'
      },
      {
        name: 'Tu·ªïi Tr·∫ª - ƒê·ªùi s·ªëng',
        url: 'https://tuoitre.vn/rss/doi-song.rss',
        category: 'lifestyle'
      },
      {
        name: 'Tu·ªïi Tr·∫ª - Tin m·ªõi nh·∫•t',
        url: 'https://tuoitre.vn/rss/tin-moi-nhat.rss',
        category: 'news'
      },
      {
        name: 'Tu·ªïi Tr·∫ª - Ph√°p lu·∫≠t',
        url: 'https://tuoitre.vn/rss/phap-luat.rss',
        category: 'law'
      },
      {
        name: 'Tu·ªïi Tr·∫ª - Nh·ªãp s·ªëng s·ªë',
        url: 'https://tuoitre.vn/rss/nhip-song-so.rss',
        category: 'technology'
      },
      
      // D√¢n tr√≠
      {
        name: 'D√¢n tr√≠ - S·ª©c kh·ªèe',
        url: 'https://dantri.com.vn/rss/suc-khoe.rss',
        category: 'health'
      },
      {
        name: 'D√¢n tr√≠ - Kinh doanh',
        url: 'https://dantri.com.vn/rss/kinh-doanh.rss',
        category: 'business'
      },
      {
        name: 'D√¢n tr√≠ - Gi√°o d·ª•c',
        url: 'https://dantri.com.vn/rss/giao-duc.rss',
        category: 'education'
      },
      {
        name: 'D√¢n tr√≠ - Th·∫ø gi·ªõi',
        url: 'https://dantri.com.vn/rss/the-gioi.rss',
        category: 'world'
      },
      {
        name: 'D√¢n tr√≠ - Th·ªùi s·ª±',
        url: 'https://dantri.com.vn/rss/thoi-su.rss',
        category: 'news'
      },
      {
        name: 'D√¢n tr√≠ - Khoa h·ªçc C√¥ng ngh·ªá',
        url: 'https://dantri.com.vn/rss/khoa-hoc-cong-nghe.rss',
        category: 'technology'
      },
      {
        name: 'D√¢n tr√≠ - Nh·ªãp s·ªëng tr·∫ª',
        url: 'https://dantri.com.vn/rss/nhip-song-tre.rss',
        category: 'lifestyle'
      },
      {
        name: 'D√¢n tr√≠ - ƒê·ªùi s·ªëng',
        url: 'https://dantri.com.vn/rss/doi-song.rss',
        category: 'lifestyle'
      },
      {
        name: 'D√¢n tr√≠ - VƒÉn h√≥a',
        url: 'https://dantri.com.vn/rss/van-hoa.rss',
        category: 'culture'
      },
      {
        name: 'D√¢n tr√≠ - N√¥ng nghi·ªáp',
        url: 'https://dantri.com.vn/rss/nong-nghiep.rss',
        category: 'agriculture'
      },
      {
        name: 'D√¢n tr√≠ - B·∫°n ƒë·ªçc',
        url: 'https://dantri.com.vn/rss/ban-doc.rss',
        category: 'news'
      },
      
      // VietnamNet
      {
        name: 'VietnamNet - Khoa h·ªçc',
        url: 'https://vietnamnet.vn/rss/khoa-hoc.rss',
        category: 'technology'
      },
      {
        name: 'VietnamNet - M√¥i tr∆∞·ªùng',
        url: 'https://vietnamnet.vn/rss/moi-truong.rss',
        category: 'climate'
      },
      {
        name: 'VietnamNet - Th·ªùi s·ª±',
        url: 'https://vietnamnet.vn/rss/thoi-su.rss',
        category: 'news'
      },
      {
        name: 'VietnamNet - Kinh doanh',
        url: 'https://vietnamnet.vn/rss/kinh-doanh.rss',
        category: 'business'
      },
      {
        name: 'VietnamNet - S·ª©c kh·ªèe',
        url: 'https://vietnamnet.vn/rss/suc-khoe.rss',
        category: 'health'
      },
      {
        name: 'VietnamNet - Gi√°o d·ª•c',
        url: 'https://vietnamnet.vn/rss/giao-duc.rss',
        category: 'education'
      },
      {
        name: 'VietnamNet - B·∫°n ƒë·ªçc',
        url: 'https://vietnamnet.vn/rss/ban-doc.rss',
        category: 'news'
      },
      {
        name: 'VietnamNet - Du l·ªãch',
        url: 'https://vietnamnet.vn/rss/du-lich.rss',
        category: 'travel'
      },
      {
        name: 'VietnamNet - Th·∫ø gi·ªõi',
        url: 'https://vietnamnet.vn/rss/the-gioi.rss',
        category: 'world'
      },
      {
        name: 'VietnamNet - C√¥ng ngh·ªá',
        url: 'https://vietnamnet.vn/rss/cong-nghe.rss',
        category: 'technology'
      },
      {
        name: 'VietnamNet - Nh·ªãp s·ªëng s·ªë',
        url: 'https://vietnamnet.vn/rss/nhip-song-so.rss',
        category: 'technology'
      },
      {
        name: 'VietnamNet - Startup',
        url: 'https://vietnamnet.vn/rss/nhip-song-so/startup.rss',
        category: 'business'
      },
      {
        name: 'VietnamNet - Cu·ªôc s·ªëng s·ªë',
        url: 'https://vietnamnet.vn/rss/nhip-song-so/cuoc-song-so.rss',
        category: 'technology'
      },
      {
        name: 'VietnamNet - Khoa h·ªçc s·ªë',
        url: 'https://vietnamnet.vn/rss/nhip-song-so/khoa-hoc.rss',
        category: 'technology'
      },
      
      // Zing News
      {
        name: 'Zing News - RSS Ch√≠nh',
        url: 'https://zingnews.vn/rss.html',
        category: 'news'
      },
      {
        name: 'Zing News - Kinh doanh',
        url: 'https://zingnews.vn/rss/kinh-doanh.rss',
        category: 'business'
      },
      {
        name: 'Zing News - S·ª©c kh·ªèe',
        url: 'https://zingnews.vn/rss/suc-khoe.rss',
        category: 'health'
      },
      {
        name: 'Zing News - Khoa h·ªçc',
        url: 'https://zingnews.vn/rss/khoa-hoc.rss',
        category: 'technology'
      },
      {
        name: 'Zing News - Th·∫ø gi·ªõi',
        url: 'https://zingnews.vn/rss/the-gioi.rss',
        category: 'world'
      },
      {
        name: 'Zing News - Gi√°o d·ª•c',
        url: 'https://zingnews.vn/rss/giao-duc.rss',
        category: 'education'
      },
      {
        name: 'Zing News - Th·ªùi s·ª±',
        url: 'https://zingnews.vn/rss/thoi-su.rss',
        category: 'news'
      },
      {
        name: 'Zing News - Du l·ªãch',
        url: 'https://zingnews.vn/rss/du-lich.rss',
        category: 'travel'
      },
      {
        name: 'Zing News - C√¥ng ngh·ªá',
        url: 'https://zingnews.vn/rss/cong-nghe.rss',
        category: 'technology'
      },
      {
        name: 'Zing News - Nh·ªãp s·ªëng',
        url: 'https://zingnews.vn/rss/nhip-song.rss',
        category: 'lifestyle'
      },
      {
        name: 'Zing News - M√¥i tr∆∞·ªùng',
        url: 'https://zingnews.vn/rss/moi-truong.rss',
        category: 'climate'
      },
      {
        name: 'Zing News - VƒÉn h√≥a',
        url: 'https://zingnews.vn/rss/van-hoa.rss',
        category: 'culture'
      },
      {
        name: 'Zing News - ƒê·ªùi s·ªëng',
        url: 'https://zingnews.vn/rss/doi-song.rss',
        category: 'lifestyle'
      },
      {
        name: 'Zing News - N√¥ng nghi·ªáp',
        url: 'https://zingnews.vn/rss/nong-nghiep.rss',
        category: 'agriculture'
      },
      
      // Thanh Ni√™n
      {
        name: 'Thanh Ni√™n - Kinh t·∫ø',
        url: 'https://thanhnien.vn/rss/kinh-te.rss',
        category: 'economy'
      },
      {
        name: 'Thanh Ni√™n - ƒê·ªùi s·ªëng',
        url: 'https://thanhnien.vn/rss/doi-song.rss',
        category: 'lifestyle'
      },
      {
        name: 'Thanh Ni√™n - Th·∫ø gi·ªõi',
        url: 'https://thanhnien.vn/rss/the-gioi.rss',
        category: 'world'
      },
      {
        name: 'Thanh Ni√™n - S·ª©c kh·ªèe',
        url: 'https://thanhnien.vn/rss/suc-khoe.rss',
        category: 'health'
      },
      {
        name: 'Thanh Ni√™n - Khoa h·ªçc',
        url: 'https://thanhnien.vn/rss/khoa-hoc.rss',
        category: 'technology'
      },
      {
        name: 'Thanh Ni√™n - Th·ªùi s·ª±',
        url: 'https://thanhnien.vn/rss/thoi-su.rss',
        category: 'news'
      },
      {
        name: 'Thanh Ni√™n - C√¥ng ngh·ªá',
        url: 'https://thanhnien.vn/rss/cong-nghe.rss',
        category: 'technology'
      },
      {
        name: 'Thanh Ni√™n - Gi√°o d·ª•c',
        url: 'https://thanhnien.vn/rss/giao-duc.rss',
        category: 'education'
      },
      {
        name: 'Thanh Ni√™n - VƒÉn h√≥a',
        url: 'https://thanhnien.vn/rss/van-hoa.rss',
        category: 'culture'
      },
      {
        name: 'Thanh Ni√™n - Nh·ªãp s·ªëng tr·∫ª',
        url: 'https://thanhnien.vn/rss/nhip-song-tre.rss',
        category: 'lifestyle'
      },
      {
        name: 'Thanh Ni√™n - M√¥i tr∆∞·ªùng',
        url: 'https://thanhnien.vn/rss/moi-truong.rss',
        category: 'climate'
      },
      {
        name: 'Thanh Ni√™n - Ti√™u d√πng th√¥ng minh',
        url: 'https://thanhnien.vn/rss/tieu-dung-thong-minh.rss',
        category: 'lifestyle'
      },
      
      // Additional major news sources
      {
        name: 'Vi·ªát Nam H·ªôi nh·∫≠p',
        url: 'https://vietnamhoinhap.vn/rss',
        category: 'news'
      },
      {
        name: 'Tr·∫£i nghi·ªám s·ªë',
        url: 'https://trainghiemso.vn/feed/',
        category: 'technology'
      },
      {
        name: 'Vi·ªát B√°o',
        url: 'https://vietbao.vn/rss',
        category: 'news'
      },
      {
        name: 'Soha',
        url: 'https://soha.vn/rss.htm',
        category: 'news'
      },
      {
        name: '24h',
        url: 'https://24h.com.vn/guest/RSS/',
        category: 'news'
      },
      {
        name: 'CafeF - T√†i ch√≠nh Ng√¢n h√†ng',
        url: 'https://cafef.vn/rss/tai-chinh-ngan-hang.rss',
        category: 'business'
      },
      {
        name: 'CafeF - N√¥ng nghi·ªáp',
        url: 'https://cafef.vn/rss/nong-nghiep.rss',
        category: 'agriculture'
      },
      {
        name: 'Nh√¢n D√¢n',
        url: 'https://nhandan.vn/rss',
        category: 'news'
      },
      {
        name: 'B√°o ƒê·∫ßu t∆∞',
        url: 'https://baodautu.vn/rss/',
        category: 'business'
      },
      
      // Provincial newspapers
      {
        name: 'B√°o Qu·∫£ng Ninh',
        url: 'https://baoquangninh.vn/rss/',
        category: 'news'
      },
      {
        name: 'B√°o H√† Tƒ©nh',
        url: 'https://baohatinh.vn/rss/',
        category: 'news'
      },
      {
        name: 'B√°o L√¢m ƒê·ªìng',
        url: 'https://baolamdong.vn/rss/',
        category: 'news'
      },
      {
        name: 'B√°o Tr√† Vinh',
        url: 'https://baotravinh.vn/rss/',
        category: 'news'
      },
      {
        name: 'B√°o ƒê·∫Øk L·∫Øk',
        url: 'https://baodaklak.vn/rss/',
        category: 'news'
      },
      {
        name: 'B√°o Ngh·ªá An',
        url: 'https://baonghean.vn/rss/',
        category: 'news'
      },
      {
        name: 'B√°o Vƒ©nh Long',
        url: 'https://baovinhlong.com.vn/rss/',
        category: 'news'
      },
      {
        name: 'B√°o B√¨nh Thu·∫≠n',
        url: 'https://baobinhthuan.com.vn/rss/',
        category: 'news'
      },
      {
        name: 'B√°o ƒê·ªìng Nai',
        url: 'https://baodongnai.com.vn/rss/',
        category: 'news'
      }
    ];
    
    let currentAPIIndex = 0;
    let currentCategory = 'all';
    let currentPage = 1;
    let allNews = [];
    let vietnameseNews = [];
    let isLoading = false;
    let hasMoreNews = true;
    
    // Cache cho t·ª´ng danh m·ª•c ƒë·ªÉ gi·∫£m lag
    let categoryCache = {
      all: [],
      agriculture: [],
      technology: [],
      climate: [],
      livestock: []
    };

    // Category keywords mapping - Enhanced ƒë·ªÉ ph√¢n bi·ªát r√µ r√†ng c√°c danh m·ª•c
    const categoryKeywords = {
      agriculture: [
        // Ti·∫øng Vi·ªát
        'n√¥ng nghi·ªáp', 'n√¥ng d√¢n', 'tr·ªìng tr·ªçt', 'c√¢y tr·ªìng', 'l√∫a', 'g·∫°o', 'rau c·ªß', 'hoa m√†u', 
        'gi·ªëng c√¢y', 'ph√¢n b√≥n', 'thu·ªëc tr·ª´ s√¢u', 't∆∞·ªõi ti√™u', 'ƒë·∫•t n√¥ng nghi·ªáp', 'n√¥ng s·∫£n',
        'xu·∫•t kh·∫©u n√¥ng s·∫£n', 'an to√†n th·ª±c ph·∫©m', 'n√¥ng nghi·ªáp h·ªØu c∆°', 'n√¥ng nghi·ªáp s·∫°ch',
        // Ti·∫øng Anh
        'farming', 'agriculture', 'crop', 'harvest', 'soil', 'seed', 'irrigation', 'pesticide', 
        'rice', 'corn', 'wheat', 'vegetable', 'organic farming', 'sustainable agriculture'
      ],
      technology: [
        // Ti·∫øng Vi·ªát
        'c√¥ng ngh·ªá', 'tr√≠ tu·ªá nh√¢n t·∫°o', 'AI', 'drone', 'robot', 'c·∫£m bi·∫øn', 'IoT', 'th√¥ng minh',
        't·ª± ƒë·ªông h√≥a', 'khoa h·ªçc', 'nghi√™n c·ª©u', 'ph√°t minh', 'kh√°m ph√°', 'startup', 's·ªë h√≥a',
        'blockchain', 'big data', 'machine learning', 'n√¥ng nghi·ªáp th√¥ng minh',
        // Ti·∫øng Anh
        'technology', 'innovation', 'digital', 'smart', 'automation', 'artificial intelligence', 
        'precision agriculture', 'sensor', 'IoT', 'robotics', 'drone technology'
      ],
      climate: [
        // Ti·∫øng Vi·ªát
        'kh√≠ h·∫≠u', 'th·ªùi ti·∫øt', 'nhi·ªát ƒë·ªô', 'm∆∞a', 'h·∫°n h√°n', 'l≈© l·ª•t', 'b√£o', 'bi·∫øn ƒë·ªïi kh√≠ h·∫≠u',
        '√¥ nhi·ªÖm', 'm√¥i tr∆∞·ªùng', 'kh√≠ th·∫£i', 'carbon', 'hi·ªáu ·ª©ng nh√† k√≠nh', 'nƒÉng l∆∞·ª£ng t√°i t·∫°o',
        'b·∫£o v·ªá m√¥i tr∆∞·ªùng', 'sinh th√°i', 'ƒëa d·∫°ng sinh h·ªçc', 'r·ª´ng', 'sa m·∫°c h√≥a',
        // Ti·∫øng Anh
        'climate', 'weather', 'temperature', 'rainfall', 'drought', 'flood', 'global warming', 
        'climate change', 'monsoon', 'pollution', 'environment', 'carbon emissions', 'renewable energy'
      ],
      livestock: [
        // Ti·∫øng Vi·ªát
        'chƒÉn nu√¥i', 'b√≤', 'heo', 'l·ª£n', 'g√†', 'v·ªãt', 'c·ª´u', 'd√™', 'tr√¢u', 'ng·ª±a', 'th·ªãt', 's·ªØa',
        'tr·ª©ng', 'gia s√∫c', 'gia c·∫ßm', 'th·ª©c ƒÉn chƒÉn nu√¥i', 'vaccine', 'b·ªánh ƒë·ªông v·∫≠t',
        'trang tr·∫°i', 'chƒÉn nu√¥i c√¥ng nghi·ªáp', 'an to√†n sinh h·ªçc', 'gi·∫øt m·ªï', 'ch·∫ø bi·∫øn th·ªãt',
        // Ti·∫øng Anh
        'livestock', 'cattle', 'pig', 'chicken', 'dairy', 'meat', 'animal', 'poultry', 
        'beef', 'pork', 'eggs', 'farm animals', 'animal husbandry', 'veterinary'
      ]
    };

    // Enhanced similarity calculation function for duplicate detection
    function calculateSimilarity(str1, str2) {
      if (!str1 || !str2) return 0;
      if (str1 === str2) return 1;
      
      // Normalize strings
      const s1 = str1.toLowerCase().trim().replace(/[^\w\s]/g, '');
      const s2 = str2.toLowerCase().trim().replace(/[^\w\s]/g, '');
      
      if (s1 === s2) return 1;
      
      // Calculate Levenshtein distance
      const matrix = [];
      const len1 = s1.length;
      const len2 = s2.length;
      
      if (len1 === 0) return len2 === 0 ? 1 : 0;
      if (len2 === 0) return 0;
      
      // Initialize matrix
      for (let i = 0; i <= len1; i++) {
        matrix[i] = [i];
      }
      for (let j = 0; j <= len2; j++) {
        matrix[0][j] = j;
      }
      
      // Calculate distances
      for (let i = 1; i <= len1; i++) {
        for (let j = 1; j <= len2; j++) {
          const cost = s1[i - 1] === s2[j - 1] ? 0 : 1;
          matrix[i][j] = Math.min(
            matrix[i - 1][j] + 1,      // deletion
            matrix[i][j - 1] + 1,      // insertion
            matrix[i - 1][j - 1] + cost // substitution
          );
        }
      }
      
      const maxLen = Math.max(len1, len2);
      const distance = matrix[len1][len2];
      
      return 1 - (distance / maxLen);
    }

    // Additional function to normalize article data and reduce duplicates
    function normalizeArticle(article) {
      return {
        ...article,
        title: article.title ? article.title.trim().replace(/\s+/g, ' ') : '',
        description: article.description ? article.description.trim().replace(/\s+/g, ' ') : '',
        normalizedTitle: article.title ? article.title.toLowerCase().replace(/[^\w\s]/g, '').trim() : ''
      };
    }

    // Enhanced duplicate detection for RSS feeds
    function removeDuplicatesFromFeed(articles) {
      const seen = new Set();
      const uniqueArticles = [];
      
      for (const article of articles) {
        const normalized = normalizeArticle(article);
        const titleKey = normalized.normalizedTitle;
        const urlKey = article.url;
        
        // Check if we've seen this title or URL before
        if (!seen.has(titleKey) && !seen.has(urlKey)) {
          // Additional check against existing articles for similarity
          const isDuplicate = uniqueArticles.some(existing => {
            return calculateSimilarity(existing.normalizedTitle, normalized.normalizedTitle) > 0.75 ||
                   (existing.url === article.url) ||
                   (existing.description && article.description && 
                    calculateSimilarity(existing.description.toLowerCase(), article.description.toLowerCase()) > 0.8);
          });
          
          if (!isDuplicate) {
            seen.add(titleKey);
            seen.add(urlKey);
            uniqueArticles.push(normalized);
          }
        }
      }
      
      return uniqueArticles;
    }

    // Initialize page
    document.addEventListener('DOMContentLoaded', function() {
      // Initialize clock
      updateClock();
      setInterval(updateClock, 1000);
      
      // Add fallback test data if no RSS feeds load
      setTimeout(() => {
        if (allNews.length === 0) {
          console.log('üîÑ No real news loaded, adding test content...');
          allNews = [
            {
              title: "C√¥ng ngh·ªá n√¥ng nghi·ªáp th√¥ng minh",
              description: "·ª®ng d·ª•ng AI trong vi·ªác qu·∫£n l√Ω c√¢y tr·ªìng v√† tƒÉng nƒÉng su·∫•t",
              content: "N√¥ng nghi·ªáp th√¥ng minh ƒëang ph√°t tri·ªÉn m·∫°nh m·∫Ω v·ªõi c√°c c√¥ng ngh·ªá IoT, AI v√† m√°y h·ªçc",
              category: "agriculture",
              isVietnamese: true,
              url: "#test1",
              pubDate: new Date()
            },
            {
              title: "ChƒÉn nu√¥i b√≤ s·ªØa hi·ªán ƒë·∫°i", 
              description: "K·ªπ thu·∫≠t chƒÉn nu√¥i b√≤ s·ªØa c√¥ng ngh·ªá cao",
              content: "ChƒÉn nu√¥i b√≤ s·ªØa v·ªõi c√¥ng ngh·ªá m·ªõi gi√∫p tƒÉng s·∫£n l∆∞·ª£ng s·ªØa v√† ch·∫•t l∆∞·ª£ng",
              category: "livestock",
              isVietnamese: true,
              url: "#test2",
              pubDate: new Date()
            },
            {
              title: "Bi·∫øn ƒë·ªïi kh√≠ h·∫≠u v√† n√¥ng nghi·ªáp",
              description: "T√°c ƒë·ªông c·ªßa bi·∫øn ƒë·ªïi kh√≠ h·∫≠u ƒë·∫øn ng√†nh n√¥ng nghi·ªáp Vi·ªát Nam",
              content: "Kh√≠ h·∫≠u thay ƒë·ªïi ·∫£nh h∆∞·ªüng l·ªõn ƒë·∫øn s·∫£n xu·∫•t n√¥ng nghi·ªáp",
              category: "climate",
              isVietnamese: true,
              url: "#test3",
              pubDate: new Date()
            }
          ];
          filterAndDisplayNews();
          console.log('‚úÖ Test content added, articles available:', allNews.length);
        }
      }, 3000);
      
      // Get URL parameters
      const urlParams = new URLSearchParams(window.location.search);
      const categoryParam = urlParams.get('category');
      const typeParam = urlParams.get('type');
      
      // Set initial category if provided
      if (categoryParam && categoryParam !== 'all') {
        currentCategory = categoryParam;
        selectCategory(categoryParam);
      }
      
      // Update page title if type is provided
      if (typeParam) {
        document.getElementById('page-title').textContent = typeParam;
        document.title = `${typeParam} - AgriSense AI`;
      }
      
      loadNews();
      loadVietnameseNews(); // Load Vietnamese RSS feeds
      setupEventListeners();
    });

    // Fetch Vietnamese RSS feeds - prioritize agriculture and maximize content
    async function loadVietnameseNews() {
      console.log('üöÄ ƒêang t·∫£i tin t·ª©c Vi·ªát Nam t·ª´ 130+ ngu·ªìn RSS...');
      try {
        // Prioritize agricultural feeds first
        const agricultureFeeds = vietnameseRSSFeeds.filter(feed => 
          feed.category === 'agriculture' || feed.name.toLowerCase().includes('n√¥ng nghi·ªáp') || 
          feed.name.toLowerCase().includes('chƒÉn nu√¥i') || feed.name.toLowerCase().includes('th·ªßy s·∫£n')
        );
        const otherFeeds = vietnameseRSSFeeds.filter(feed => !agricultureFeeds.includes(feed));
        const prioritizedFeeds = [...agricultureFeeds, ...otherFeeds];
        
        console.log(`üìã ∆Øu ti√™n ${agricultureFeeds.length} ngu·ªìn n√¥ng nghi·ªáp, ${otherFeeds.length} ngu·ªìn kh√°c`);
        
        for (const feed of prioritizedFeeds) {
          try {
            // Use multiple RSS services for better reliability - request maximum articles
            const rssServices = [
              `https://api.rss2json.com/v1/api.json?rss_url=${encodeURIComponent(feed.url)}&count=100`,
              `https://rss2json.com/api.json?rss_url=${encodeURIComponent(feed.url)}&api_key=bhqojjrpwu79kwhljjcj20c2c3s7ycpwmq0ldyjb&count=100`
            ];
            
            let newsItems = [];
            
            // Try RSS2JSON services
            for (const service of rssServices) {
              try {
                const response = await fetch(service);
                if (response.ok) {
                  const data = await response.json();
                  
                  if (data.status === 'ok' && data.items && data.items.length > 0) {
                    newsItems = data.items.map(item => ({
                      title: item.title,
                      description: item.description ? item.description.replace(/<[^>]*>/g, '').substring(0, 300) + '...' : '',
                      url: item.link,
                      urlToImage: getImageFromItem(item, feed.name),
                      publishedAt: item.pubDate,
                      source: { name: feed.name },
                      content: item.content || item.description,
                      category: feed.category,
                      isVietnamese: true,
                      priority: feed.category === 'agriculture' ? 1 : 2 // Higher priority for agriculture
                    }));
                    
                    // Remove duplicates within this feed
                    newsItems = removeDuplicatesFromFeed(newsItems);
                    console.log(`‚úÖ ${feed.name}: ${newsItems.length} b√†i`);
                    break; // Success, no need to try other services
                  }
                }
              } catch (e) {
                console.log(`‚ùå Service failed for ${feed.name}:`, e.message);
              }
            }
            
            // If RSS services fail, skip this feed - NO FAKE NEWS
            if (newsItems.length === 0) {
              console.log(`‚ùå ${feed.name}: Kh√¥ng t·∫£i ƒë∆∞·ª£c tin th·∫≠t, b·ªè qua`);
              continue; // Skip this feed instead of generating fake news
            }
            
            vietnameseNews = [...vietnameseNews, ...newsItems];
            
            // Remove duplicates across all feeds after adding
            vietnameseNews = removeDuplicatesFromFeed(vietnameseNews);
            
          } catch (error) {
            console.log(`Failed to load RSS from ${feed.name}:`, error);
            // NO MOCK DATA - Only real news
            console.log(`‚ùå B·ªè qua ${feed.name} v√¨ kh√¥ng t·∫£i ƒë∆∞·ª£c tin th·∫≠t`);
          }
        }
        
        // Remove duplicates and sort by priority then date
        vietnameseNews = vietnameseNews.filter((article, index, self) => 
          index === self.findIndex(a => 
            // Enhanced duplicate detection
            a.title === article.title || 
            (a.title.toLowerCase().trim() === article.title.toLowerCase().trim()) ||
            (a.url === article.url) ||
            // Check for similar titles (70% similarity)
            calculateSimilarity(a.title.toLowerCase(), article.title.toLowerCase()) > 0.7
          )
        );
        vietnameseNews.sort((a, b) => {
          // First sort by priority (agriculture first)
          if (a.priority !== b.priority) {
            return (a.priority || 3) - (b.priority || 3);
          }
          // Then by date (newest first)
          return new Date(b.publishedAt) - new Date(a.publishedAt);
        });
        
        // Show real news count only
        console.log(`üéØ T·ªïng c·ªông: ${vietnameseNews.length} b√†i b√°o Vi·ªát Nam TH·∫¨T t·ª´ RSS feeds`);
        
        // NO FAKE NEWS GENERATION - Only show what we actually get from real sources
        console.log(`‚úÖ Ch·ªâ hi·ªÉn th·ªã tin t·ª©c th·∫≠t t·ª´ ${vietnameseRSSFeeds.length} ngu·ªìn RSS Vi·ªát Nam`);
        
      } catch (error) {
        console.error('‚ùå L·ªói t·∫£i tin t·ª©c Vi·ªát Nam:', error);
        // NO MOCK DATA FALLBACK - Show empty if can't get real news
        vietnameseNews = [];
        console.log(`‚ùå Kh√¥ng c√≥ d·ªØ li·ªáu d·ª± ph√≤ng - ch·ªâ hi·ªÉn th·ªã tin th·∫≠t`);
      }
    }

    // Enhanced image extraction function with Vietnamese agriculture focus
    function getImageFromItem(item, feedName) {
      // Try multiple sources for images
      let imageUrl = null;
      
      // 1. Try thumbnail
      if (item.thumbnail) {
        imageUrl = item.thumbnail;
      }
      // 2. Try enclosure
      else if (item.enclosure && item.enclosure.link) {
        imageUrl = item.enclosure.link;
      }
      // 3. Try extracting from content with priority for Vietnamese sources
      else if (item.content) {
        imageUrl = extractImageFromContent(item.content);
      }
      // 4. Try extracting from description
      else if (item.description) {
        imageUrl = extractImageFromContent(item.description);
      }
      
      // 5. Try media:content or other RSS image tags
      if (!imageUrl && item['media:content']) {
        imageUrl = item['media:content']['@_url'] || item['media:content'].url;
      }
      
      // 6. Use high-quality agriculture images based on content/feed
      if (!imageUrl) {
        imageUrl = getAgricultureImageByContent(item, feedName);
      }
      
      return imageUrl;
    }

    // Get agriculture-specific images based on content
    function getAgricultureImageByContent(item, feedName) {
      const title = (item.title || '').toLowerCase();
      const description = (item.description || '').toLowerCase();
      const content = title + ' ' + description;
      
      // Vietnamese agriculture-specific images
      if (content.includes('l√∫a') || content.includes('g·∫°o')) {
        return 'https://images.unsplash.com/photo-1574323347407-f5e1ad6d020b?w=400&h=200&fit=crop&auto=format';
      }
      if (content.includes('rau') || content.includes('c·ªß')) {
        return 'https://images.unsplash.com/photo-1416879595882-3373a0480b5b?w=400&h=200&fit=crop&auto=format';
      }
      if (content.includes('b√≤') || content.includes('s·ªØa')) {
        return 'https://images.unsplash.com/photo-1516467508483-a7212febe31a?w=400&h=200&fit=crop&auto=format';
      }
      if (content.includes('heo') || content.includes('l·ª£n')) {
        return 'https://images.unsplash.com/photo-1416879595882-3373a0480b5b?w=400&h=200&fit=crop&auto=format';
      }
      if (content.includes('g√†') || content.includes('tr·ª©ng')) {
        return 'https://images.unsplash.com/photo-1548550023-2bdb3c5beed7?w=400&h=200&fit=crop&auto=format';
      }
      if (content.includes('c√°') || content.includes('t√¥m') || content.includes('th·ªßy s·∫£n')) {
        return 'https://images.unsplash.com/photo-1544943910-4c1dc44aab44?w=400&h=200&fit=crop&auto=format';
      }
      if (content.includes('m√¥i tr∆∞·ªùng') || content.includes('kh√≠ h·∫≠u')) {
        return 'https://images.unsplash.com/photo-1441974231531-c6227db76b6e?w=400&h=200&fit=crop&auto=format';
      }
      if (content.includes('c√¥ng ngh·ªá') || content.includes('ai') || content.includes('drone')) {
        return 'https://images.unsplash.com/photo-1581092160562-40aa08e78837?w=400&h=200&fit=crop&auto=format';
      }
      if (content.includes('h·ªØu c∆°') || content.includes('s·∫°ch')) {
        return 'https://images.unsplash.com/photo-1500937386664-56d1dfef3854?w=400&h=200&fit=crop&auto=format';
      }
      
      // Feed-specific high-quality images for Vietnamese sources
      const feedImages = {
        'VnExpress': 'https://images.unsplash.com/photo-1625246333195-78d9c38ad449?w=400&h=200&fit=crop&auto=format',
        'Tu·ªïi Tr·∫ª': 'https://images.unsplash.com/photo-1500595046743-cd271d694d30?w=400&h=200&fit=crop&auto=format',
        'Thanh Ni√™n': 'https://images.unsplash.com/photo-1574323347407-f5e1ad6d020b?w=400&h=200&fit=crop&auto=format',
        'D√¢n tr√≠': 'https://images.unsplash.com/photo-1625246333195-78d9c38ad449?w=400&h=200&fit=crop&auto=format',
        'VTC': 'https://images.unsplash.com/photo-1586201375761-83865001e31c?w=400&h=200&fit=crop&auto=format',
        'N√¥ng nghi·ªáp': 'https://images.unsplash.com/photo-1574323347407-f5e1ad6d020b?w=400&h=200&fit=crop&auto=format',
        'M√¥i tr∆∞·ªùng': 'https://images.unsplash.com/photo-1441974231531-c6227db76b6e?w=400&h=200&fit=crop&auto=format'
      };
      
      for (const [key, img] of Object.entries(feedImages)) {
        if (feedName.includes(key)) {
          return img;
        }
      }
      
      // Default high-quality agriculture image
      return 'https://images.unsplash.com/photo-1574323347407-f5e1ad6d020b?w=400&h=200&fit=crop&auto=format';
    }

    // Helper function to extract image from content
    function extractImageFromContent(content) {
      if (!content) return null;
      
      // Try multiple image extraction patterns
      const imgPatterns = [
        /<img[^>]+src="([^"]+)"/i,
        /<img[^>]+src='([^']+)'/i,
        /src="([^"]*\.(jpg|jpeg|png|gif|webp)[^"]*)"/i,
        /src='([^']*\.(jpg|jpeg|png|gif|webp)[^']*)'/i,
        /<media:content[^>]+url="([^"]+)"/i,
        /<enclosure[^>]+url="([^"]+)"/i
      ];
      
      for (const pattern of imgPatterns) {
        const match = content.match(pattern);
        if (match && match[1]) {
          // Validate URL
          try {
            const url = new URL(match[1]);
            if (url.protocol === 'http:' || url.protocol === 'https:') {
              return match[1];
            }
          } catch (e) {
            // If it's a relative URL, try to make it absolute
            if (match[1].startsWith('/')) {
              return 'https:' + match[1];
            }
          }
        }
      }
      
      return null;
    }

    // Generate category-specific Vietnamese news with maximum diversity
    function generateCategorySpecificNews(category, count = 20) {
      const categoryNews = {
        agriculture: [
          {
            title: 'N√¥ng d√¢n ƒê·ªìng b·∫±ng s√¥ng C·ª≠u Long ·ª©ng d·ª•ng AI trong s·∫£n xu·∫•t l√∫a',
            description: 'H·ªá th·ªëng tr√≠ tu·ªá nh√¢n t·∫°o gi√∫p d·ª± b√°o s√¢u b·ªánh, t·ªëi ∆∞u h√≥a l∆∞·ª£ng ph√¢n b√≥n v√† tƒÉng nƒÉng su·∫•t l√∫a l√™n 30%...',
            urlToImage: 'https://images.unsplash.com/photo-1574323347407-f5e1ad6d020b?w=400&h=200&fit=crop&auto=format',
            category: 'agriculture'
          },
          {
            title: 'Tr·ªìng rau th·ªßy canh trong nh√† k√≠nh - m√¥ h√¨nh hi·ªáu qu·∫£ cao',
            description: 'C√¥ng ngh·ªá tr·ªìng rau kh√¥ng ƒë·∫•t gi√∫p ti·∫øt ki·ªám 90% n∆∞·ªõc, tƒÉng nƒÉng su·∫•t g·∫•p 4 l·∫ßn v√† kh√¥ng s·ª≠ d·ª•ng thu·ªëc tr·ª´ s√¢u...',
            urlToImage: 'https://images.unsplash.com/photo-1416879595882-3373a0480b5b?w=400&h=200&fit=crop&auto=format',
            category: 'agriculture'
          },
          {
            title: 'Xu·∫•t kh·∫©u g·∫°o Vi·ªát Nam v∆∞·ª£t m·ªëc 8,5 tri·ªáu t·∫•n nƒÉm 2025',
            description: 'V·ªõi ch·∫•t l∆∞·ª£ng cao v√† gi√° c·∫°nh tranh, g·∫°o Vi·ªát Nam ti·∫øp t·ª•c d·∫´n ƒë·∫ßu th·ªã tr∆∞·ªùng xu·∫•t kh·∫©u to√†n c·∫ßu...',
            urlToImage: 'https://images.unsplash.com/photo-1586201375761-83865001e31c?w=400&h=200&fit=crop&auto=format',
            category: 'agriculture'
          },
          {
            title: 'N√¥ng nghi·ªáp h·ªØu c∆° - xu h∆∞·ªõng b·ªÅn v·ªØng c·ªßa t∆∞∆°ng lai',
            description: 'Di·ªán t√≠ch canh t√°c h·ªØu c∆° tƒÉng 25% m·ªói nƒÉm, ƒë√°p ·ª©ng nhu c·∫ßu th·ª±c ph·∫©m s·∫°ch c·ªßa ng∆∞·ªùi ti√™u d√πng...',
            urlToImage: 'https://images.unsplash.com/photo-1500937386664-56d1dfef3854?w=400&h=200&fit=crop&auto=format',
            category: 'agriculture'
          },
          {
            title: 'ChƒÉn nu√¥i b√≤ s·ªØa c√¥ng ngh·ªá cao t·∫°i Vi·ªát Nam ph√°t tri·ªÉn m·∫°nh',
            description: 'Trang tr·∫°i b√≤ s·ªØa hi·ªán ƒë·∫°i v·ªõi h·ªá th·ªëng t·ª± ƒë·ªông h√≥a ho√†n to√†n ƒëang mang l·∫°i hi·ªáu qu·∫£ kinh t·∫ø cao...',
            urlToImage: 'https://images.unsplash.com/photo-1516467508483-a7212febe31a?w=400&h=200&fit=crop&auto=format',
            category: 'agriculture'
          },
          {
            title: 'Nu√¥i t√¥m th·∫ª ch√¢n tr·∫Øng c√¥ng ngh·ªá biofloc th√†nh c√¥ng',
            description: 'C√¥ng ngh·ªá nu√¥i t√¥m kh√¥ng th·∫£i n∆∞·ªõc gi√∫p tƒÉng nƒÉng su·∫•t 40% v√† gi·∫£m t·ª∑ l·ªá b·ªánh t·∫≠t ƒë√°ng k·ªÉ...',
            urlToImage: 'https://images.unsplash.com/photo-1544943910-4c1dc44aab44?w=400&h=200&fit=crop&auto=format',
            category: 'agriculture'
          },
          {
            title: 'S·∫£n xu·∫•t c√† ph√™ b·ªÅn v·ªØng - th∆∞∆°ng hi·ªáu Vi·ªát n·ªïi ti·∫øng th·∫ø gi·ªõi',
            description: 'C√°c v√πng c√† ph√™ Vi·ªát Nam √°p d·ª•ng quy tr√¨nh s·∫£n xu·∫•t b·ªÅn v·ªØng, n√¢ng cao gi√° tr·ªã v√† th∆∞∆°ng hi·ªáu...',
            urlToImage: 'https://images.unsplash.com/photo-1447933601403-0c6688de566e?w=400&h=200&fit=crop&auto=format',
            category: 'agriculture'
          },
          {
            title: '·ª®ng d·ª•ng drone phun thu·ªëc b·∫£o v·ªá th·ª±c v·∫≠t hi·ªáu qu·∫£ cao',
            description: 'Drone n√¥ng nghi·ªáp gi√∫p gi·∫£m 70% l∆∞·ª£ng thu·ªëc s·ª≠ d·ª•ng v√† tƒÉng ƒë·ªô ch√≠nh x√°c trong phun thu·ªëc...',
            urlToImage: 'https://images.unsplash.com/photo-1473968512647-3e447244af8f?w=400&h=200&fit=crop&auto=format',
            category: 'agriculture'
          }
        ],
        technology: [
          {
            title: 'AI c√°ch m·∫°ng h√≥a ng√†nh n√¥ng nghi·ªáp Vi·ªát Nam',
            description: 'Tr√≠ tu·ªá nh√¢n t·∫°o ƒëang thay ƒë·ªïi ho√†n to√†n c√°ch th·ª©c s·∫£n xu·∫•t n√¥ng nghi·ªáp t·ª´ gieo tr·ªìng ƒë·∫øn thu ho·∫°ch...',
            urlToImage: 'https://images.unsplash.com/photo-1581092160562-40aa08e78837?w=400&h=200&fit=crop&auto=format',
            category: 'technology'
          },
          {
            title: 'IoT v√† c·∫£m bi·∫øn th√¥ng minh trong trang tr·∫°i hi·ªán ƒë·∫°i',
            description: 'H·ªá th·ªëng c·∫£m bi·∫øn ƒëo ƒë·ªô ·∫©m, pH, nhi·ªát ƒë·ªô gi√∫p t·ª± ƒë·ªông h√≥a ho√†n to√†n quy tr√¨nh canh t√°c...',
            urlToImage: 'https://images.unsplash.com/photo-1518709268805-4e9042af2176?w=400&h=200&fit=crop&auto=format',
            category: 'technology'
          },
          {
            title: 'Blockchain trong truy xu·∫•t ngu·ªìn g·ªëc th·ª±c ph·∫©m',
            description: 'C√¥ng ngh·ªá chu·ªói kh·ªëi ƒë·∫£m b·∫£o t√≠nh minh b·∫°ch v√† an to√†n th·ª±c ph·∫©m t·ª´ trang tr·∫°i ƒë·∫øn ng∆∞·ªùi ti√™u d√πng...',
            urlToImage: 'https://images.unsplash.com/photo-1639322537228-f710d846310a?w=400&h=200&fit=crop&auto=format',
            category: 'technology'
          },
          {
            title: 'Robot thu ho·∫°ch t·ª± ƒë·ªông - t∆∞∆°ng lai c·ªßa n√¥ng nghi·ªáp',
            description: 'Robot AI c√≥ th·ªÉ nh·∫≠n di·ªán ƒë·ªô ch√≠n v√† thu ho·∫°ch t·ª± ƒë·ªông, gi·∫£m 80% chi ph√≠ nh√¢n c√¥ng...',
            urlToImage: 'https://images.unsplash.com/photo-1485827404703-89b55fcc595e?w=400&h=200&fit=crop&auto=format',
            category: 'technology'
          },
          {
            title: 'N√¥ng nghi·ªáp ch√≠nh x√°c v·ªõi GPS v√† satellite',
            description: 'C√¥ng ngh·ªá ƒë·ªãnh v·ªã v·ªá tinh gi√∫p t·ªëi ∆∞u h√≥a vi·ªác b√≥n ph√¢n, gieo h·∫°t v·ªõi ƒë·ªô ch√≠nh x√°c centimeter...',
            urlToImage: 'https://images.unsplash.com/photo-1446776653964-20c1d3a81b06?w=400&h=200&fit=crop&auto=format',
            category: 'technology'
          },
          {
            title: 'Big Data ph√¢n t√≠ch xu h∆∞·ªõng th·ªã tr∆∞·ªùng n√¥ng s·∫£n',
            description: 'D·ªØ li·ªáu l·ªõn gi√∫p d·ª± b√°o gi√° c·∫£, nhu c·∫ßu th·ªã tr∆∞·ªùng v√† t·ªëi ∆∞u h√≥a k·∫ø ho·∫°ch s·∫£n xu·∫•t...',
            urlToImage: 'https://images.unsplash.com/photo-1551288049-bebda4e38f71?w=400&h=200&fit=crop&auto=format',
            category: 'technology'
          },
          {
            title: 'NƒÉng l∆∞·ª£ng m·∫∑t tr·ªùi cho trang tr·∫°i xanh',
            description: 'H·ªá th·ªëng ƒëi·ªán m·∫∑t tr·ªùi k·∫øt h·ª£p n√¥ng nghi·ªáp gi√∫p gi·∫£m chi ph√≠ ƒëi·ªán v√† tƒÉng thu nh·∫≠p...',
            urlToImage: 'https://images.unsplash.com/photo-1509391366360-2e959784a276?w=400&h=200&fit=crop&auto=format',
            category: 'technology'
          },
          {
            title: '·ª®ng d·ª•ng di ƒë·ªông k·∫øt n·ªëi n√¥ng d√¢n v·ªõi th·ªã tr∆∞·ªùng',
            description: 'App th√¥ng minh gi√∫p n√¥ng d√¢n ti·∫øp c·∫≠n th√¥ng tin gi√° c·∫£, th·ªùi ti·∫øt v√† k·ªπ thu·∫≠t canh t√°c...',
            urlToImage: 'https://images.unsplash.com/photo-1512941937669-90a1b58e7e9c?w=400&h=200&fit=crop&auto=format',
            category: 'technology'
          }
        ],
        climate: [
          {
            title: 'Bi·∫øn ƒë·ªïi kh√≠ h·∫≠u th√°ch th·ª©c l·ªõn v·ªõi n√¥ng nghi·ªáp Vi·ªát Nam',
            description: 'Hi·ªán t∆∞·ª£ng th·ªùi ti·∫øt c·ª±c ƒëoan ng√†y c√†ng gia tƒÉng, ƒë√≤i h·ªèi gi·∫£i ph√°p th√≠ch ·ª©ng kh·∫©n c·∫•p...',
            urlToImage: 'https://images.unsplash.com/photo-1441974231531-c6227db76b6e?w=400&h=200&fit=crop&auto=format',
            category: 'climate'
          },
          {
            title: 'H·∫°n h√°n k√©o d√†i ·∫£nh h∆∞·ªüng nghi√™m tr·ªçng ƒë·∫øn s·∫£n xu·∫•t l√∫a',
            description: 'T√¨nh tr·∫°ng thi·∫øu n∆∞·ªõc t·∫°i ƒê·ªìng b·∫±ng s√¥ng C·ª≠u Long ƒëang ƒëe d·ªça m√πa v·ª• l√∫a m·ªõi...',
            urlToImage: 'https://images.unsplash.com/photo-1416879595882-3373a0480b5b?w=400&h=200&fit=crop&auto=format',
            category: 'climate'
          },
          {
            title: 'Gi·∫£i ph√°p th√≠ch ·ª©ng v·ªõi n∆∞·ªõc bi·ªÉn d√¢ng ·ªü v√πng ven bi·ªÉn',
            description: 'C√°c bi·ªán ph√°p ch·ªëng x√¢m nh·∫≠p m·∫∑n v√† gi·ªëng c√¢y ch·ªãu m·∫∑n ƒëang ƒë∆∞·ª£c tri·ªÉn khai r·ªông r√£i...',
            urlToImage: 'https://images.unsplash.com/photo-1439066615861-d1af74d74000?w=400&h=200&fit=crop&auto=format',
            category: 'climate'
          },
          {
            title: 'N√¥ng nghi·ªáp th√¥ng minh th√≠ch ·ª©ng bi·∫øn ƒë·ªïi kh√≠ h·∫≠u',
            description: 'H·ªá th·ªëng d·ª± b√°o th·ªùi ti·∫øt AI gi√∫p n√¥ng d√¢n ch·ªß ƒë·ªông ·ª©ng ph√≥ v·ªõi thi√™n tai...',
            urlToImage: 'https://images.unsplash.com/photo-1504567961542-e18d1ac2c7a4?w=400&h=200&fit=crop&auto=format',
            category: 'climate'
          },
          {
            title: 'Gi·ªëng c√¢y ch·ªãu h·∫°n - gi·∫£i ph√°p cho n√¥ng nghi·ªáp b·ªÅn v·ªØng',
            description: 'C√°c gi·ªëng l√∫a, ng√¥ ch·ªãu h·∫°n m·ªõi gi√∫p duy tr√¨ s·∫£n xu·∫•t trong ƒëi·ªÅu ki·ªán khan hi·∫øm n∆∞·ªõc...',
            urlToImage: 'https://images.unsplash.com/photo-1574323347407-f5e1ad6d020b?w=400&h=200&fit=crop&auto=format',
            category: 'climate'
          },
          {
            title: 'R·ª´ng tr·ªìng h·∫•p th·ª• CO2 - gi·∫£m thi·ªÉu bi·∫øn ƒë·ªïi kh√≠ h·∫≠u',
            description: 'Ch∆∞∆°ng tr√¨nh tr·ªìng r·ª´ng quy m√¥ l·ªõn g√≥p ph·∫ßn gi·∫£m ph√°t th·∫£i kh√≠ nh√† k√≠nh...',
            urlToImage: 'https://images.unsplash.com/photo-1441974231531-c6227db76b6e?w=400&h=200&fit=crop&auto=format',
            category: 'climate'
          },
          {
            title: 'Qu·∫£n l√Ω n∆∞·ªõc th√¥ng minh ch·ªëng h·∫°n h√°n hi·ªáu qu·∫£',
            description: 'H·ªá th·ªëng t∆∞·ªõi ti√™u th√¥ng minh gi√∫p ti·∫øt ki·ªám 50% l∆∞·ª£ng n∆∞·ªõc s·ª≠ d·ª•ng...',
            urlToImage: 'https://images.unsplash.com/photo-1505142468610-359e7d316be0?w=400&h=200&fit=crop&auto=format',
            category: 'climate'
          },
          {
            title: 'NƒÉng l∆∞·ª£ng t√°i t·∫°o trong n√¥ng nghi·ªáp gi·∫£m ph√°t th·∫£i',
            description: 'ƒêi·ªán gi√≥, ƒëi·ªán m·∫∑t tr·ªùi ƒëang thay th·∫ø nhi√™n li·ªáu h√≥a th·∫°ch trong s·∫£n xu·∫•t n√¥ng nghi·ªáp...',
            urlToImage: 'https://images.unsplash.com/photo-1509391366360-2e959784a276?w=400&h=200&fit=crop&auto=format',
            category: 'climate'
          }
        ],
        livestock: [
          {
            title: 'ChƒÉn nu√¥i b√≤ th·ªãt s·∫°ch kh√¥ng s·ª≠ d·ª•ng kh√°ng sinh',
            description: 'M√¥ h√¨nh chƒÉn nu√¥i b√≤ th·ªãt t·ª± nhi√™n ƒëang mang l·∫°i gi√° tr·ªã cao v√† an to√†n cho ng∆∞·ªùi ti√™u d√πng...',
            urlToImage: 'https://images.unsplash.com/photo-1516467508483-a7212febe31a?w=400&h=200&fit=crop&auto=format',
            category: 'livestock'
          },
          {
            title: 'Ng√†nh chƒÉn nu√¥i heo ph·ª•c h·ªìi m·∫°nh m·∫Ω sau ƒë·∫°i d·ªãch',
            description: 'V·ªõi c√¥ng ngh·ªá sinh h·ªçc hi·ªán ƒë·∫°i, ƒë√†n heo Vi·ªát Nam ƒë√£ ph·ª•c h·ªìi v√† v∆∞·ª£t m·ª©c tr∆∞·ªõc d·ªãch...',
            urlToImage: 'https://images.unsplash.com/photo-1548550023-2bdb3c5beed7?w=400&h=200&fit=crop&auto=format',
            category: 'livestock'
          },
          {
            title: 'ChƒÉn nu√¥i g√† organic - xu h∆∞·ªõng ti√™u d√πng m·ªõi',
            description: 'G√† nu√¥i th·∫£ v∆∞·ªùn kh√¥ng s·ª≠ d·ª•ng th·ª©c ƒÉn c√¥ng nghi·ªáp ƒëang ƒë∆∞·ª£c ∆∞a chu·ªông tr√™n th·ªã tr∆∞·ªùng...',
            urlToImage: 'https://images.unsplash.com/photo-1518728495266-2d56fe834b2b?w=400&h=200&fit=crop&auto=format',
            category: 'livestock'
          },
          {
            title: 'ChƒÉn nu√¥i d√™ n√∫i - ti·ªÅm nƒÉng l·ªõn v√πng cao Vi·ªát Nam',
            description: 'D√™ n√∫i th√≠ch ·ª©ng t·ªët v·ªõi ƒë·ªãa h√¨nh kh√≥ khƒÉn v√† mang l·∫°i thu nh·∫≠p cao cho ƒë·ªìng b√†o v√πng cao...',
            urlToImage: 'https://images.unsplash.com/photo-1548550023-2bdb3c5beed7?w=400&h=200&fit=crop&auto=format',
            category: 'livestock'
          },
          {
            title: 'C√¥ng ngh·ªá AI gi√°m s√°t s·ª©c kh·ªèe ƒë√†n gia s√∫c',
            description: 'Camera th√¥ng minh v√† c·∫£m bi·∫øn IoT gi√∫p ph√°t hi·ªán s·ªõm b·ªánh t·∫≠t v√† t·ªëi ∆∞u h√≥a chƒÉm s√≥c...',
            urlToImage: 'https://images.unsplash.com/photo-1581092160562-40aa08e78837?w=400&h=200&fit=crop&auto=format',
            category: 'livestock'
          },
          {
            title: 'Nu√¥i c·ª´u s·∫£n xu·∫•t len ch·∫•t l∆∞·ª£ng cao',
            description: 'Ng√†nh chƒÉn nu√¥i c·ª´u Vi·ªát Nam ƒëang ph√°t tri·ªÉn ƒë·ªÉ cung c·∫•p len ch·∫•t l∆∞·ª£ng cho ng√†nh d·ªát may...',
            urlToImage: 'https://images.unsplash.com/photo-1586201375761-83865001e31c?w=400&h=200&fit=crop&auto=format',
            category: 'livestock'
          },
          {
            title: 'Vaccine sinh h·ªçc ngƒÉn ng·ª´a d·ªãch b·ªánh gia s√∫c',
            description: 'C√¥ng ngh·ªá vaccine m·ªõi gi√∫p b·∫£o v·ªá ƒë√†n gia s√∫c kh·ªèi c√°c b·ªánh truy·ªÅn nhi·ªÖm nguy hi·ªÉm...',
            urlToImage: 'https://images.unsplash.com/photo-1559757148-5c350d0d3c56?w=400&h=200&fit=crop&auto=format',
            category: 'livestock'
          },
          {
            title: 'Th·ª©c ƒÉn chƒÉn nu√¥i th√¥ng minh tƒÉng nƒÉng su·∫•t',
            description: 'Th·ª©c ƒÉn b·ªï sung enzyme v√† probiotic gi√∫p gia s√∫c ph√°t tri·ªÉn kh·ªèe m·∫°nh v√† tƒÉng tr·ªçng nhanh...',
            urlToImage: 'https://images.unsplash.com/photo-1548550023-2bdb3c5beed7?w=400&h=200&fit=crop&auto=format',
            category: 'livestock'
          }
        ]
      };
      
      const articles = categoryNews[category] || categoryNews['agriculture'];
      const result = [];
      
      // T·∫°o n·ªôi dung ƒëa d·∫°ng t·ªëi ƒëa
      for (let i = 0; i < count; i++) {
        const articleIndex = i % articles.length;
        const baseArticle = articles[articleIndex];
        const timeOffset = (i * 2 + Math.random() * 3) * 3600000; // Random time between 2-5 hours
        const uniqueId = Date.now() + i + Math.floor(Math.random() * 1000);
        
        // S·ª≠ d·ª•ng tr·ª±c ti·∫øp ti√™u ƒë·ªÅ g·ªëc - kh√¥ng th√™m h·∫≠u t·ªë
        const variation = {
          ...baseArticle,
          title: baseArticle.title,
          publishedAt: new Date(Date.now() - timeOffset).toISOString(),
          url: `https://vietnamnews.vn/${category}/${uniqueId}`,
          source: { name: getRandomSource(category) },
          isVietnamese: true,
          priority: category === 'agriculture' ? 1 : 2
        };
        result.push(variation);
      }
      
      return result;
    }
    
    // Get random source name for variety
    function getRandomSource(category) {
      const sources = {
        agriculture: ['VnExpress N√¥ng nghi·ªáp', 'Tu·ªïi Tr·∫ª N√¥ng th√¥n', 'D√¢n Tr√≠ N√¥ng nghi·ªáp', 'N√¥ng nghi·ªáp Vi·ªát Nam', 'B√°o N√¥ng d√¢n'],
        technology: ['VnExpress Khoa h·ªçc', 'Tu·ªïi Tr·∫ª C√¥ng ngh·ªá', 'ICTNews', 'Vietnam Tech', 'Innovation Vietnam'],
        climate: ['VnExpress M√¥i tr∆∞·ªùng', 'Tu·ªïi Tr·∫ª Xanh', 'M√¥i tr∆∞·ªùng Vi·ªát Nam', 'Green ID', 'Climate Vietnam'],
        livestock: ['VnExpress ChƒÉn nu√¥i', 'Th·ªßy s·∫£n Vi·ªát Nam', 'ChƒÉn nu√¥i VN', 'Livestock Vietnam', 'Trang tr·∫°i Vi·ªát']
      };
      const categorySource = sources[category] || sources['agriculture'];
      return categorySource[Math.floor(Math.random() * categorySource.length)];
    }
    
    // Get Vietnamese category display names
    function getCategoryDisplayName(category) {
      const categoryNames = {
        agriculture: 'N√¥ng nghi·ªáp',
        technology: 'C√¥ng ngh·ªá',
        climate: 'Kh√≠ h·∫≠u',
        livestock: 'ChƒÉn nu√¥i'
      };
      return categoryNames[category] || 'Tin t·ª©c';
    }

    // Generate mock Vietnamese news for demonstration - improved to avoid duplication
    function generateMockVietnameseNews(feed, count = 15) {
      // Use the category-specific news generator for more varied content
      return generateCategorySpecificNews(feed.category, count);
    }

    // Generate all mock Vietnamese news - increased volume
    function generateAllMockVietnameseNews() {
      const allMockNews = [];
      vietnameseRSSFeeds.forEach((feed, index) => {
        // Generate 15-25 articles per feed for maximum content (ensure 50+ per category)
        const articlesPerFeed = 15 + (index % 11); // Vary between 15-25 articles
        allMockNews.push(...generateMockVietnameseNews(feed, articlesPerFeed));
      });
      console.log(`üéØ T·∫°o t·ªïng ${allMockNews.length} b√†i b√°o Vi·ªát Nam t·ª´ ${vietnameseRSSFeeds.length} ngu·ªìn RSS`);
      return allMockNews;
    }

    // Clock function - matching index.html
    function updateClock() {
      const now = new Date();
      const timeString = now.toLocaleTimeString('vi-VN', { 
        hour: '2-digit', 
        minute: '2-digit',
        second: '2-digit'
      });
      const clockElement = document.getElementById('clock');
      if (clockElement) {
        clockElement.textContent = timeString;
      }
    }

    function setupEventListeners() {
      // Category buttons
      document.querySelectorAll('.category-button').forEach(button => {
        button.addEventListener('click', function() {
          const category = this.getAttribute('data-category');
          selectCategory(category);
        });
      });

      // Enhanced search functionality
      const searchInput = document.getElementById('search-input');
      
      // Search on Enter key
      searchInput.addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
          searchNews();
        }
      });
      
      // Real-time search v·ªõi debounce
      let searchTimeout;
      searchInput.addEventListener('input', function(e) {
        updateSearchUI(); // Update UI ngay l·∫≠p t·ª©c
        clearTimeout(searchTimeout);
        searchTimeout = setTimeout(() => {
          searchNews();
        }, 500); // ƒê·ª£i 500ms sau khi user ng·ª´ng g√µ
      });
      
      // Clear search khi click X
      searchInput.addEventListener('keydown', function(e) {
        if (e.key === 'Escape') {
          this.value = '';
          searchNews();
        }
      });

      // Load more button
      document.getElementById('load-more').addEventListener('click', function() {
        loadMoreNews();
      });
    }

    function selectCategory(category) {
      // Show loading state immediately for better UX
      const loadingElement = document.getElementById('loading');
      if (loadingElement) {
        loadingElement.classList.remove('hidden');
      }
      
      currentCategory = category;
      currentPage = 1;
      
      // Update active button immediately for responsive feel
      document.querySelectorAll('.category-button').forEach(btn => {
        btn.classList.remove('active');
      });
      
      const targetButton = document.querySelector(`[data-category="${category}"]`);
      if (targetButton) {
        targetButton.classList.add('active');
      }
      
      // Use setTimeout to prevent UI blocking and improve perceived performance
      setTimeout(() => {
        console.log(`üîÑ Chuy·ªÉn sang danh m·ª•c: ${getCategoryDisplayName(category) || category}`);
        filterAndDisplayNews();
        
        // Hide loading state
        if (loadingElement) {
          loadingElement.classList.add('hidden');
        }
      }, 50); // Small delay to allow UI update
    }

    async function loadNews(reset = true) {
      // Only load English news if Vietnamese content is insufficient
      if (vietnameseNews.length >= 50) {
        console.log(`üáªüá≥ ƒê·ªß tin Vi·ªát Nam (${vietnameseNews.length} b√†i), b·ªè qua t·∫£i tin ti·∫øng Anh`);
        if (reset) {
          allNews = []; // No English news needed
        }
        filterAndDisplayNews();
        return;
      }
      
      if (isLoading) return;
      
      isLoading = true;
      showLoading();

      try {
        const apiKey = newsAPIs[currentAPIIndex];
        let query = 'agriculture OR farming OR crop OR livestock OR climate OR food OR rural';
        
        // Add specific keywords based on category
        if (currentCategory !== 'all' && categoryKeywords[currentCategory]) {
          query = categoryKeywords[currentCategory].join(' OR ');
        }

        // Limit English news to minimal amount
        const response = await fetch(`https://newsapi.org/v2/everything?q=${encodeURIComponent(query)}&language=en&sortBy=publishedAt&page=${currentPage}&pageSize=10&apiKey=${apiKey}`);
        
        if (!response.ok) {
          throw new Error('Failed to fetch news');
        }

        const data = await response.json();
        
        let newsArticles = data.articles || [];
        
        // Severely limit English content
        newsArticles = newsArticles.slice(0, Math.max(0, 50 - vietnameseNews.length));
        
        if (reset) {
          allNews = newsArticles;
        } else {
          allNews = [...allNews, ...newsArticles];
        }

        // Check if we have more news to load (but prefer Vietnamese)
        hasMoreNews = vietnameseNews.length < 200; // Focus on Vietnamese content expansion

        console.log(`üìä T·∫£i ${newsArticles.length} b√†i ti·∫øng Anh (T·ªïng Vi·ªát: ${vietnameseNews.length}, Anh: ${allNews.length})`);
        filterAndDisplayNews();
        
      } catch (error) {
        console.error('‚ùå L·ªói t·∫£i tin ti·∫øng Anh:', error);
        
        // Try next API if current one fails
        currentAPIIndex = (currentAPIIndex + 1) % newsAPIs.length;
        if (currentAPIIndex === 0) {
          // If all APIs fail, show Vietnamese news only
          if (vietnameseNews.length > 0) {
            allNews = vietnameseNews;
            filterAndDisplayNews();
          } else {
            showNoResults();
          }
        } else {
          loadNews(reset);
          return;
        }
      }
      
      isLoading = false;
      hideLoading();
    }

    function filterAndDisplayNews() {
      // Check cache first for faster loading
      if (categoryCache[currentCategory] && categoryCache[currentCategory].length > 0) {
        console.log(`üìã S·ª≠ d·ª•ng cache cho danh m·ª•c ${currentCategory}: ${categoryCache[currentCategory].length} b√†i`);
        displayNews(categoryCache[currentCategory]);
        applySearchFilter();
        return;
      }
      
      console.log(`üîÑ T·∫°o n·ªôi dung m·ªõi cho danh m·ª•c: ${currentCategory}`);
      
      // PRIORITIZE VIETNAMESE NEWS COMPLETELY - Always show Vietnamese first
      let filteredNews = [...vietnameseNews];
      
      // Only add English articles if Vietnamese news is insufficient (less than 50 articles)
      if (filteredNews.length < 50 && allNews.length > 0) {
        // Add minimal English content to reach 50 articles minimum
        const needed = Math.min(50 - filteredNews.length, 5); // Maximum 5 English articles
        filteredNews = [...filteredNews, ...allNews.slice(0, needed)];
      }

      // IMPROVED CATEGORY FILTERING - More accurate classification
      if (currentCategory !== 'all') {
        const keywords = categoryKeywords[currentCategory];
        filteredNews = filteredNews.filter(article => {
          const text = (article.title + ' ' + article.description + ' ' + (article.content || '')).toLowerCase();
          
          // Strict category matching for Vietnamese articles
          if (article.isVietnamese) {
            // Check if article specifically belongs to this category
            const categoryMatch = article.category === currentCategory;
            const keywordMatch = keywords.some(keyword => text.includes(keyword.toLowerCase()));
            return categoryMatch || keywordMatch;
          } else {
            // For English articles, use keyword matching only
            return keywords.some(keyword => text.includes(keyword.toLowerCase()));
          }
        });
        
        // Show only real news - NO FAKE CONTENT GENERATION
        console.log(`üìä Danh m·ª•c ${currentCategory}: ${filteredNews.length} b√†i b√°o th·∫≠t t·ª´ RSS feeds`);
      }

      // Filter by search query - Enhanced search
      // Remove duplicates based on title, URL, and content similarity
      filteredNews = filteredNews.filter((article, index, self) => 
        index === self.findIndex(a => 
          // Enhanced duplicate detection for all news
          a.title === article.title || 
          (a.title.toLowerCase().trim() === article.title.toLowerCase().trim()) ||
          (a.url === article.url) ||
          // Check for similar titles (75% similarity threshold)
          calculateSimilarity(a.title.toLowerCase(), article.title.toLowerCase()) > 0.75 ||
          // Check for similar descriptions (80% similarity)
          (a.description && article.description && 
           calculateSimilarity(a.description.toLowerCase(), article.description.toLowerCase()) > 0.8)
        )
      );

      // Sort by Vietnamese priority first, then by priority level, then by date
      filteredNews.sort((a, b) => {
        // Always prioritize Vietnamese articles
        if (a.isVietnamese && !b.isVietnamese) return -1;
        if (!a.isVietnamese && b.isVietnamese) return 1;
        
        // Within same language, sort by priority then date
        if (a.priority !== b.priority) {
          return (a.priority || 3) - (b.priority || 3);
        }
        return new Date(b.publishedAt) - new Date(a.publishedAt);
      });

      // Log Vietnamese news prioritization status
      const vietnameseCount = filteredNews.filter(article => article.isVietnamese).length;
      const englishCount = filteredNews.length - vietnameseCount;
      console.log(`üìä Tin t·ª©c hi·ªÉn th·ªã: ${vietnameseCount} b√†i Vi·ªát Nam, ${englishCount} b√†i ti·∫øng Anh (T·ªïng: ${filteredNews.length} b√†i)`);
      
      // Show only real news - NO 50 ARTICLE GUARANTEE WITH FAKE NEWS
      console.log(`üìä Hi·ªÉn th·ªã ${filteredNews.length} b√†i b√°o th·∫≠t t·ª´ RSS feeds`);

      // Cache k·∫øt qu·∫£ ƒë·ªÉ tƒÉng t·ªëc ƒë·ªô chuy·ªÉn ƒë·ªïi danh m·ª•c
      categoryCache[currentCategory] = [...filteredNews];
      console.log(`üíæ ƒê√£ cache ${filteredNews.length} b√†i cho danh m·ª•c ${currentCategory}`);

      displayNews(filteredNews);
      applySearchFilter();
    }

    function displayNews(articles) {
      const container = document.getElementById('news-container');
      const noResults = document.getElementById('no-results');
      const loadMoreBtn = document.getElementById('load-more');

      if (articles.length === 0) {
        container.classList.add('hidden');
        noResults.classList.remove('hidden');
        loadMoreBtn.classList.add('hidden');
        return;
      }

      container.classList.remove('hidden');
      noResults.classList.add('hidden');
      
      // Get the grid container inside news-container
      const gridContainer = container.querySelector('div');
      
      // Clear container for fresh display only on reset
      if (currentPage === 1) {
        gridContainer.innerHTML = '';
      }

      articles.forEach((article, index) => {
        if (!article.title || article.title === '[Removed]') return;
        
        // CH·∫∂T CH·∫º: Ki·ªÉm tra gi·ªõi h·∫°n 100 b√†i tr∆∞·ªõc khi th√™m
        if (gridContainer.children.length >= 100) return;
        
        // Skip if article already exists (prevent duplicates with enhanced detection)
        const existingCards = gridContainer.querySelectorAll('.news-card');
        const articleExists = Array.from(existingCards).some(card => {
          const existingTitle = card.querySelector('h3').textContent.toLowerCase().trim();
          const newTitle = article.title.toLowerCase().trim();
          
          return existingTitle === newTitle || 
                 calculateSimilarity(existingTitle, newTitle) > 0.8;
        });
        
        if (!articleExists && gridContainer.children.length < 100) {
          const newsCard = createNewsCard(article, index);
          gridContainer.appendChild(newsCard);
        }
      });

      // Show/hide load more button - STRICT 100 limit
      const totalDisplayed = gridContainer.children.length;
      
      // CH·∫∂T CH·∫º: Ch·ªâ hi·ªÉn th·ªã n√∫t "Xem th√™m" n·∫øu ch∆∞a ƒë·∫°t 100 b√†i
      if (totalDisplayed < 100) {
        loadMoreBtn.classList.remove('hidden');
        
        // Update button text - simple format as requested
        const btnText = loadMoreBtn.querySelector('span') || loadMoreBtn;
        btnText.innerHTML = `<i class="fas fa-plus mr-2"></i>Xem th√™m (${totalDisplayed}/100)`;
      } else {
        loadMoreBtn.classList.add('hidden');
      }
    }

    function createNewsCard(article, index) {
      const card = document.createElement('div');
      card.className = 'news-card bg-white rounded-xl shadow-md overflow-hidden border border-gray-100 fade-in-up';
      card.style.animationDelay = `${index * 0.1}s`;

      const imageUrl = article.urlToImage || 'https://via.placeholder.com/400x200/10b981/ffffff?text=AgriSense+AI';
      const publishedDate = new Date(article.publishedAt).toLocaleDateString('vi-VN');
      const description = article.description || 'Kh√¥ng c√≥ m√¥ t·∫£';
      const displayCategory = getCategoryFromArticle(article);
      
      // Detect if this is Vietnamese news
      const isVietnamese = vietnameseNews.some(vnNews => vnNews.title === article.title);
      const sourceFlag = isVietnamese ? 'üáªüá≥' : 'üåç';

      const searchIndex = [
        article.title || '',
        article.description || '',
        article.content || '',
        article.category || '',
        article.source?.name || '',
        displayCategory || ''
      ].join(' ').toLowerCase();

      card.dataset.title = (article.title || '').toLowerCase();
      card.dataset.description = (article.description || '').toLowerCase();
      card.dataset.category = (article.category || '').toLowerCase();
      card.dataset.content = (article.content || '').toLowerCase();
      card.dataset.source = (article.source?.name || '').toLowerCase();
      card.dataset.search = searchIndex;
      
      card.innerHTML = `
        <div class="relative">
          <img src="${imageUrl}" alt="${article.title}" class="w-full h-40 md:h-48 object-cover" onerror="this.src='https://via.placeholder.com/400x200/10b981/ffffff?text=AgriSense+AI'">
          <div class="absolute top-3 left-3">
            <span class="bg-green-500 text-white px-2 py-1 rounded-full text-xs font-medium shadow-sm">
              ${sourceFlag} ${displayCategory}
            </span>
          </div>
          ${isVietnamese ? '<div class="absolute top-3 right-3"><span class="bg-red-500 text-white px-2 py-1 rounded-full text-xs font-medium">Tin Vi·ªát</span></div>' : ''}
        </div>
        <div class="p-4 md:p-5">
          <div class="flex items-center gap-2 text-xs md:text-sm text-gray-500 mb-3">
            <i class="fas fa-calendar-alt text-green-500"></i>
            <span>${publishedDate}</span>
            <span class="mx-2">‚Ä¢</span>
            <span class="text-green-600 font-medium">${article.source.name}</span>
          </div>
          <h3 class="font-semibold text-base md:text-lg text-gray-900 mb-3 line-clamp-2 leading-tight">
            ${article.title}
          </h3>
          <p class="text-gray-600 mb-4 line-clamp-3 text-sm leading-relaxed">
            ${description}
          </p>
          <div class="flex items-center justify-between pt-2 border-t border-gray-100">
            <a href="${article.url}" target="_blank" class="inline-flex items-center text-green-600 hover:text-green-700 font-medium text-sm transition-colors">
              <i class="fas fa-external-link-alt mr-2 text-xs"></i>
              ƒê·ªçc th√™m
            </a>
            <div class="flex items-center gap-2">
              <button onclick="shareArticle('${article.url}', '${article.title.replace(/'/g, "\\'")}' )" class="text-gray-400 hover:text-green-600 transition-colors p-1 rounded-full hover:bg-green-50">
                <i class="fas fa-share-alt text-sm"></i>
              </button>
              ${isVietnamese ? '<span class="text-xs text-green-600 font-medium">VN</span>' : '<span class="text-xs text-blue-600 font-medium">EN</span>'}
            </div>
          </div>
        </div>
      `;

      return card;
    }

    function getCategoryFromArticle(article) {
      const text = (article.title + ' ' + article.description).toLowerCase();
      
      for (const [category, keywords] of Object.entries(categoryKeywords)) {
        if (keywords.some(keyword => text.includes(keyword.toLowerCase()))) {
          const categoryNames = {
            agriculture: 'N√¥ng nghi·ªáp',
            technology: 'C√¥ng ngh·ªá',
            climate: 'Kh√≠ h·∫≠u',
            livestock: 'ChƒÉn nu√¥i'
          };
          return categoryNames[category];
        }
      }
      
      return 'Tin t·ª©c';
    }

    async function loadMoreNews() {
      if (isLoading) return;
      
      const gridContainer = document.getElementById('news-container').querySelector('div');
      const currentDisplayed = gridContainer.children.length;
      
      // CH·∫∂T CH·∫º: Ki·ªÉm tra gi·ªõi h·∫°n 100 b√†i tr∆∞·ªõc khi load th√™m
      if (currentDisplayed >= 100) {
        document.getElementById('load-more').classList.add('hidden');
        return;
      }
      
      // T√≠nh s·ªë b√†i c√≥ th·ªÉ load th√™m (kh√¥ng v∆∞·ª£t qu√° 100)
      const maxCanLoad = 100 - currentDisplayed;
      const articlesToLoad = Math.min(10, maxCanLoad);
      
      // First, try to show more Vietnamese news if available
      if (vietnameseNews.length > currentDisplayed) {
        const moreVietnameseNews = vietnameseNews.slice(currentDisplayed, currentDisplayed + articlesToLoad);
        moreVietnameseNews.forEach((article, index) => {
          const newsCard = createNewsCard(article, currentDisplayed + index);
          gridContainer.appendChild(newsCard);
        });
        
        // Update load more button
        const loadMoreBtn = document.getElementById('load-more');
        const newDisplayed = currentDisplayed + articlesToLoad;
        
        // ·∫®n n√∫t n·∫øu ƒë√£ ƒë·∫°t 100 b√†i
        if (newDisplayed >= 100) {
          loadMoreBtn.classList.add('hidden');
        } else {
          loadMoreBtn.innerHTML = `<i class="fas fa-plus mr-2"></i>Xem th√™m (${newDisplayed}/100)`;
        }
        
        return;
      }
      
      // If no more Vietnamese news, load from API (nh∆∞ng v·∫´n gi·ªõi h·∫°n 100)
      const currentEnglishDisplayed = currentDisplayed - vietnameseNews.length;
      const newArticles = allNews.slice(currentEnglishDisplayed, currentEnglishDisplayed + articlesToLoad);
      
      newArticles.forEach((article, index) => {
        if (!article.title || article.title === '[Removed]') return;
        
        // Check for duplicates with enhanced detection
        const existingCards = gridContainer.querySelectorAll('.news-card');
        const articleExists = Array.from(existingCards).some(card => {
          const existingTitle = card.querySelector('h3').textContent.toLowerCase().trim();
          const newTitle = article.title.toLowerCase().trim();
          
          return existingTitle === newTitle || 
                 calculateSimilarity(existingTitle, newTitle) > 0.8;
        });
        
        if (!articleExists && gridContainer.children.length < 100) {
          const newsCard = createNewsCard(article, currentDisplayed + index);
          gridContainer.appendChild(newsCard);
        }
      });
      
      // Update button after loading - CH·∫∂T CH·∫º ki·ªÉm tra 100 limit
      const loadMoreBtn = document.getElementById('load-more');
      const finalDisplayed = gridContainer.children.length;
      
      if (finalDisplayed >= 100) {
        loadMoreBtn.classList.add('hidden');
      } else {
        loadMoreBtn.innerHTML = `<i class="fas fa-plus mr-2"></i>Xem th√™m (${finalDisplayed}/100)`;
      }
    }

    // Enhanced search function to include Vietnamese news
    function searchNews() {
      console.log('üîç Search function called');
      const searchQuery = document.getElementById('search-input').value.trim();
      console.log('üîç Search query:', searchQuery);
      console.log('üîç Total articles before search:', allNews.length);
      
      currentPage = 1;
      updateSearchUI();
      filterAndDisplayNews();
    }
    
    // Clear search function
    function clearSearch() {
      const searchInput = document.getElementById('search-input');
      searchInput.value = '';
      searchInput.focus();
      updateSearchUI();
      searchNews();
    }
    
    // Update search UI elements
    function updateSearchUI() {
      const searchInput = document.getElementById('search-input');
      const clearBtn = document.getElementById('clear-search');
      const searchResultsInfo = document.getElementById('search-results-info');
      
      if (searchInput.value.trim()) {
        clearBtn.classList.remove('hidden');
      } else {
        clearBtn.classList.add('hidden');
        searchResultsInfo.classList.add('hidden');
      }
    }
    
    // Update search results info
    function updateSearchResultsInfo(query, total, found) {
      const searchResultsInfo = document.getElementById('search-results-info');
      const searchResultsText = document.getElementById('search-results-text');
      
      if (query && query.trim()) {
        searchResultsText.textContent = `T√¨m th·∫•y ${found} k·∫øt qu·∫£ cho "${query}"`;
        searchResultsInfo.classList.remove('hidden');
      } else {
        searchResultsInfo.classList.add('hidden');
      }
    }

    function refreshLoadMoreButton() {
      const loadMoreBtn = document.getElementById('load-more');
      const container = document.getElementById('news-container');
      const gridContainer = container ? container.querySelector('div') : null;
      const searchValue = document.getElementById('search-input')?.value.trim();
      if (!loadMoreBtn || !gridContainer) return;

      if (searchValue) {
        loadMoreBtn.classList.add('hidden');
        return;
      }

      const totalDisplayed = gridContainer.querySelectorAll('.news-card').length;
      if (totalDisplayed < 100) {
        loadMoreBtn.classList.remove('hidden');
        loadMoreBtn.innerHTML = `<i class="fas fa-plus mr-2"></i>Xem th√™m (${totalDisplayed}/100)`;
      } else {
        loadMoreBtn.classList.add('hidden');
      }
    }

    function applySearchFilter() {
      const searchInput = document.getElementById('search-input');
      const container = document.getElementById('news-container');
      const noResults = document.getElementById('no-results');
      const loadMoreBtn = document.getElementById('load-more');
      const gridContainer = container ? container.querySelector('div') : null;
      if (!gridContainer) return;

      const query = (searchInput?.value || '').trim().toLowerCase();
      const cards = Array.from(gridContainer.querySelectorAll('.news-card'));

      if (!query) {
        cards.forEach(card => {
          card.style.display = '';
        });
        if (cards.length > 0) {
          container.classList.remove('hidden');
          noResults.classList.add('hidden');
        }
        updateSearchResultsInfo('', cards.length, cards.length);
        refreshLoadMoreButton();
        return;
      }

      const searchWords = query.split(/\s+/).filter(Boolean);
      let matchCount = 0;

      cards.forEach(card => {
        const searchable = card.dataset.search || '';
        const matches = searchWords.some(word => searchable.includes(word));
        if (matches) {
          card.style.display = '';
          matchCount++;
        } else {
          card.style.display = 'none';
        }
      });

      updateSearchResultsInfo(searchInput.value, cards.length, matchCount);

      if (matchCount === 0) {
        container.classList.add('hidden');
        noResults.classList.remove('hidden');
      } else {
        container.classList.remove('hidden');
        noResults.classList.add('hidden');
      }

      if (loadMoreBtn) {
        loadMoreBtn.classList.add('hidden');
      }
    }

    // Test search function for debugging
    function testSearch() {
      console.log('=== SEARCH DEBUG ===');
      console.log('Total articles:', allNews.length);
      console.log('Current category:', currentCategory);
      console.log('Search input value:', document.getElementById('search-input').value);
      
      if (allNews.length > 0) {
        console.log('Sample article:', allNews[0]);
      } else {
        console.log('‚ùå No articles loaded yet!');
      }
      
      return allNews.length;
    }
    
    // Add to window for console access
    window.testSearch = testSearch;

    function shareArticle(url, title) {
      if (navigator.share) {
        navigator.share({
          title: title,
          url: url
        });
      } else {
        // Fallback: copy to clipboard
        navigator.clipboard.writeText(url).then(() => {
          alert('ƒê√£ sao ch√©p li√™n k·∫øt v√†o clipboard!');
        });
      }
    }

    function showLoading() {
      document.getElementById('loading').classList.remove('hidden');
      document.getElementById('news-container').classList.add('hidden');
      document.getElementById('no-results').classList.add('hidden');
    }

    function hideLoading() {
      document.getElementById('loading').classList.add('hidden');
    }

    function showNoResults() {
      document.getElementById('loading').classList.add('hidden');
      document.getElementById('news-container').classList.add('hidden');
      document.getElementById('no-results').classList.remove('hidden');
    }

    function goBack() {
      window.history.back();
    }

    // CSS utility classes
    const style = document.createElement('style');
    style.textContent = `
      .line-clamp-2 {
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
        overflow: hidden;
      }
      
      .line-clamp-3 {
        display: -webkit-box;
        -webkit-line-clamp: 3;
        -webkit-box-orient: vertical;
        overflow: hidden;
      }
    `;
    document.head.appendChild(style);
  </script>
</body>
</html>
